---
- name: Deploy single workflow from definition
  hosts: nsp
  gather_facts: no
  
  tasks:
    - name: Define hello world workflow
      nokia.nsp.wfm:
        define: |
          ---
          version: '2.0'
          
          helloworld:
            description: Simple test workflow for CI/CD
            type: direct
            
            tags:
              - test
              - ci-cd

            input:
              - host: 127.0.0.1
              - seconds: 1
            
            output:
              result: <% task("pingtask").result %>
            
            tasks:
              pingtask:
                action: nsp.ping
                input:
                  host: <% $.host %>
                  duration: <% $.seconds %>
      register: deploy_result
    
    - name: Display workflow information
      debug:
        msg: |
          Workflow deployed successfully:
            - Name: {{ deploy_result.workflow_name }}
            - ID: {{ deploy_result.workflow_id }}
            - Status: {{ deploy_result.status }}

    - name: Execute workflow
      nokia.nsp.wfm:
        execute: "{{ deploy_result.workflow_id }}"
        input:
          host: localhost
          seconds: 5
      register: exec_result

    - name: Show execution result
      debug:
        var: exec_result

    - name: Delete workflow
      nokia.nsp.wfm:
        delete: "{{ deploy_result.workflow_id }}"
      register: exec_result
